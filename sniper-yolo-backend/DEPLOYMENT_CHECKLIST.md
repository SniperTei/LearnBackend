# 📋 部署检查清单

## 服务器准备

- [ ] 服务器已购买并启动
- [ ] 服务器操作系统为 Linux (Ubuntu 20.04+ 或 CentOS 7+)
- [ ] 服务器配置: 最低 2核4GB，推荐 4核8GB
- [ ] 服务器磁盘空间充足 (至少 20GB)

## 网络配置

- [ ] 服务器防火墙已配置必要端口
  - [ ] SSH: 22
  - [ ] HTTP: 80
  - [ ] HTTPS: 443
  - [ ] 开发环境 API: 8001
  - [ ] 测试环境 API: 8002
  - [ ] 开发环境 Nginx: 8080
  - [ ] 测试环境 Nginx: 8081
- [ ] 域名已解析（如适用）

## 软件安装

- [ ] Docker 已安装 (版本 20.10+)
- [ ] Docker Compose 已安装 (版本 2.0+)
- [ ] Git 已安装 (可选)
- [ ] 当前用户已添加到 docker 组

## 代码部署

- [ ] 代码已上传到服务器
- [ ] 项目目录已创建
- [ ] 所有必需文件已复制

## 配置文件

### 开发环境

- [ ] `.env.dev` 文件已配置
  - [ ] 数据库密码已修改
  - [ ] 七牛云配置已填写
  - [ ] SECRET_KEY 已设置
  - [ ] CORS 配置正确

### 测试环境

- [ ] `.env.test` 文件已配置
  - [ ] 数据库密码已修改
  - [ ] 七牛云配置已填写
  - [ ] SECRET_KEY 已设置
  - [ ] CORS 配置正确

## 数据库

- [ ] PostgreSQL 数据库容器正常启动
- [ ] 数据库迁移已执行
- [ ] 数据库连接测试通过

## 服务部署

### 开发环境

- [ ] Docker 镜像已构建
- [ ] 所有容器已启动
- [ ] 服务健康检查通过
- [ ] API 可正常访问
- [ ] Nginx 反向代理正常

### 测试环境

- [ ] Docker 镜像已构建
- [ ] 所有容器已启动
- [ ] 服务健康检查通过
- [ ] API 可正常访问
- [ ] Nginx 反向代理正常

## 功能测试

### 基础功能

- [ ] 用户注册/登录
- [ ] Token 认证
- [ ] 图片上传功能
- [ ] 数据查询功能
- [ ] 数据创建功能

### API 端点

- [ ] `/api/v1/health` - 健康检查
- [ ] `/api/v1/auth/login` - 用户登录
- [ ] `/api/v1/auth/register` - 用户注册
- [ ] `/api/v1/upload/image` - 图片上传
- [ ] 其他业务端点

## 日志和监控

- [ ] 日志目录已创建
- [ ] 日志可正常查看
- [ ] 日志轮转已配置
- [ ] 容器监控正常

## 备份策略

- [ ] 数据库备份脚本已配置
- [ ] 自动备份任务已设置
- [ ] 备份文件可正常恢复

## 安全检查

- [ ] 默认密码已修改
- [ ] API 密钥已更换
- [ ] 不必要的端口已关闭
- [ ] 防火墙规则已优化
- [ ] SSL 证书已配置（如需要）

## 文档和清单

- [ ] 部署文档已阅读
- [ ] 快速开始指南已阅读
- [ ] 本检查清单已完成

## 上线前最终确认

- [ ] 所有测试用例通过
- [ ] 性能测试符合要求
- [ ] 安全审计已完成
- [ ] 监控告警已配置
- [ ] 应急预案已准备

---

## 部署后验证命令

```bash
# 检查容器状态
docker ps

# 检查开发环境
curl http://localhost:8001/api/v1/health

# 检查测试环境
curl http://localhost:8002/api/v1/health

# 查看日志
./deploy.sh dev logs
./deploy.sh test logs

# 检查资源使用
docker stats
```

## 常见问题快速修复

1. **容器启动失败**
   ```bash
   ./deploy.sh dev logs
   ./deploy.sh dev restart
   ```

2. **数据库连接失败**
   ```bash
   docker restart sniper_postgres_dev
   ./deploy.sh dev migrate
   ```

3. **端口被占用**
   ```bash
   sudo netstat -tlnp | grep :8001
   sudo kill -9 <PID>
   ```

---

**检查清单版本**: 1.0.0
**最后更新**: 2025-02-08
